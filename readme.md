# AI算力管理平台 - 设计文档

## 项目概述

半导体数字化与IT装备部AI算力管理平台，用于统一管理红区和黄区两个网络区域的AI算力资源，提供算力申请、令牌分配、运营监控等功能。

## 技术栈

- **前端框架**: 纯HTML + JavaScript (ES6+)
- **样式**: Tailwind CSS (CDN)
- **图表库**: Chart.js (CDN)
- **UI组件**: 自定义Toast通知系统、Modal模态框
- **特点**: 无需构建工具，可直接在浏览器中运行

## 功能特性

### 已完成功能

| 功能模块 | 说明 |
|---------|------|
| Toast通知系统 | 右上角弹出通知，支持成功/错误/警告/信息四种类型 |
| Modal模态框 | 统一的弹窗组件，用于表单和确认操作 |
| 角色权限控制 | 基于URL参数(role=admin/user)，普通用户隐藏管理员菜单 |
| 图表高度修复 | 修复了柱状图高度持续增长的动画bug |
| 按钮交互 | 所有操作按钮均已实现点击反馈和功能演示 |

### 交互功能说明

- **新建令牌**: 弹出表单，输入名称和过期时间，实时添加到列表
- **吊销令牌**: 确认对话框，吊销后该行变灰显示
- **添加用户**: 弹出表单，输入姓名、部门、额度，实时添加
- **编辑额度**: 弹出表单修改用户Token额度
- **添加GPU服务器**: 弹出表单，选择型号和区域，实时添加
- **添加模型**: 弹出表单，设置消耗系数和部署区域
- **发布公告**: 选择公告类型，输入内容，实时发布到列表
- **添加告警规则**: 自定义告警名称和触发条件
- **保存系统配置**: 保存所有系统参数配置
- **时间范围切换**: 切换时图表数据随机波动，模拟实时更新

## 页面结构

### 1. 登录页 (index.html)

| 元素 | 说明 |
|------|------|
| Logo | 平台标识 |
| 用户名/密码 | 演示账号已预填 (admin/123456) |
| 角色选择 | 管理员 / 普通用户 |
| 登录按钮 | 跳转到主界面，URL带role参数 |

**角色权限说明**:
- 管理员(`?role=admin`): 可访问所有页面
- 普通用户(`?role=user`): 隐藏"额度管理"和"系统配置"菜单

---

### 2. 主框架 (dashboard.html)

#### 2.1 侧边导航

| 导航项 | 页面ID | 说明 | 权限 |
|--------|--------|------|------|
| 我的算力 | page-my-computing | 用户查看个人算力、令牌、项目挂靠 | 所有用户 |
| 额度管理 | page-quota-manage | 配额申请和审批 | 所有用户/管理员 |
| 运营看板 | page-dashboard | GPU、Token、成本运营监控 | 所有用户 |
| 项目管理 | page-projects | 项目配额和成员管理 | 仅管理员 |
| 用户管理 | page-user-management | 用户列表和额度管理 | 仅管理员 |
| 系统配置 | page-system-config | GPU/模型/公告配置 | 仅管理员 |

#### 2.2 顶部状态栏

- 页面标题
- 系统状态指示（运行正常/异常）
- 通知铃铛图标（点击显示暂无新通知）

#### 2.3 全局组件

**Toast通知容器** (`#toastContainer`)
- 位置: 右上角固定
- 动画: 滑入、淡出
- 类型: success(绿色)/error(红色)/warning(黄色)/info(蓝色)
- 自动消失: 3秒后自动关闭

**Modal模态框** (`#modalOverlay`)
- 遮罩层: 半透明黑色背景
- 动画: 淡入、缩放
- 关闭: 点击关闭按钮、点击遮罩、按确认/取消
- 内容: 动态插入表单或提示信息

---

### 3. 我的算力页面

#### 项目挂靠卡片

| 功能 | 说明 |
|------|------|
| 当前挂靠项目 | 显示用户当前所属项目 |
| 挂靠时间 | 项目开始时间至今 |
| 切换项目 | 切换到其他有余额的项目 |
| 查看历史 | 查看项目挂靠变更记录 |

#### 核心指标卡片

| 指标 | 说明 |
|------|------|
| 总Token额度 | 1,000,000 Token |
| 已使用 | 325,680 Token |
| 剩余额度 | 674,320 Token |
| 使用率 | 32.6% |

#### 图表展示

| 图表 | 类型 | 说明 |
|------|------|------|
| Token使用趋势 | 折线图 | 按月展示消耗趋势 |
| 模型使用分布 | 环形图 | 各模型调用占比 |

#### 项目挂靠规则
- 用户首次申请额度时选择项目，挂靠关系从审批通过时确立
- 切换项目时只能选择有剩余额度的项目
- 切换后原项目余额保留（由项目经理分配）
- 挂靠历史记录保存历次变更

#### 令牌管理表格

| 列 | 说明 |
|----|------|
| 令牌名称 | 用户自定义名称 |
| 令牌ID | 唯一标识 |
| 创建时间 | 令牌生成时间 |
| 过期时间 | 令牌失效时间 |
| 状态 | 正常/即将过期/已失效 |
| 操作 | 查看/吊销 |

---

### 4. 额度管理页面（管理员）

#### 操作按钮

| 功能 | 说明 |
|------|------|
| 批量导入额度 | Excel上传 |
| 批量导出额度 | 导出用户额度数据 |
| 添加用户 | 单个添加用户 |

#### 用户额度列表

| 列 | 说明 |
|----|------|
| 用户姓名 | |
| 所属部门 | 芯片设计部/验证部/封装部等 |
| 当前额度 | 分配的Token总额 |
| 已使用 | 已消耗Token |
| 剩余额度 | 可用Token |
| 使用率 | 进度条+百分比，颜色预警 |
| 状态 | 正常/即将耗尽/已耗尽 |
| 操作 | 编辑/删除 |

---

### 5. 运营看板页面

#### 时间选择器

- 快速选择：近7天 / 近30天 / 近90天
- 自定义：日期范围选择

#### 视图切换：运维监控 / 成本运营 / 资源分析

---

#### 5.1 运维监控

**模型筛选器**
- 支持多选筛选特定模型
- 可选择查看选中模型的响应时间和吞吐量

**核心指标卡片**

| 指标 | 说明 |
|------|------|
| GPU总卡数 | 200张 |
| 可用卡数 | 48 / 200 空闲 |
| 平均使用率 | 76% 实时负载 |
| 异常卡数 | 3张有告警 |

**图表展示**

| 图表 | 类型 | 说明 |
|------|------|------|
| GPU使用率趋势 | 折线图 | 按小时/天/周/月粒度 |
| 服务器负载分布 | 柱状图 | 0-25%/25-50%/50-75%/75-100% 区间分布 |

**GPU服务器状态列表**

| 列 | 说明 |
|----|------|
| 服务器名称 | gpu-server-001 ~ 020 |
| GPU配置 | A100/H100 数量 |
| 使用率 | 实时负载，颜色标识 |
| 状态 | 绿色/黄色/红色 |

**异常告警记录**

| 告警类型 | 说明 |
|----------|------|
| GPU负载过高 | 单卡或服务器负载超过阈值 |
| 并发数量较高 | API并发请求峰值 |
| 连通性测试失败 | 服务器无法连接 |
| 模型降智 | 模型响应质量下降 |

---

#### 5.2 成本运营

**核心指标卡片**

| 指标 | 说明 |
|------|------|
| Token总消耗 | 近30天累计 15.6M |
| 人均消耗 | 181K Token/人 |
| 部门成本 | 6个部门合计 ¥156K |
| 项目成本 | 24个项目合计 ¥89K |

**图表展示**

| 图表 | 类型 | 说明 |
|------|------|------|
| 成本趋势 | 折线图 | 成本月度变化 |
| 部门消耗对比 | 堆叠柱状图 | 各部门消耗分布 |
| 人均消耗对比 | 柱状图 | 各部门人均消耗 |
| 项目成本排名 | 横向柱状图 | Top10项目成本 |

---

#### 5.3 资源分析

**核心指标卡片**

| 指标 | 说明 |
|------|------|
| 用户配额使用 | 平均使用率 68.5% |
| 用户活跃度 | 86/活跃用户 |
| 用户项目归属 | 人均3.2个项目 |
| 用户成本贡献 | 人均 ¥1.82K |

**图表展示**

| 图表 | 类型 | 说明 |
|------|------|------|
| 模型调用量Top10 | 横向柱状图 | 模型使用排行 |
| 用户消耗Top10 | 列表 | 用户Token消耗排行 |
| 部门资源占用 | 帕累托图 | 80/20分析 |
| 项目消耗Token占比 | 环形图 | 各项目消耗分布 |
| 模型调用趋势 | 折线图 | 调用量变化趋势 |

---

### 6. 系统配置页面

#### 系统参数配置

| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| 默认Token额度 | 1,000,000 | 新用户默认分配额度 |
| 额度预警阈值 | 80% | 触发预警的使用率 |
| GPU高负载阈值 | 85% | 判定高负载的百分比 |
| 令牌默认有效期 | 90天 | 可选30天/90天/1年/永不过期 |
| 最大并发请求数 | 100/用户 | 每用户最大并发 |
| 请求速率限制 | 60/分钟 | API调用频率限制 |
| 数据保留天数 | 90天 | 历史数据保存时长 |
| 系统维护模式 | 正常运行 | 可切换为维护中 |

**操作**: 点击"保存配置"按钮保存所有参数

#### 告警规则配置

预设规则:
| 规则名称 | 触发条件 | 状态 |
|----------|----------|------|
| GPU负载过高 | 使用率>85%持续5分钟 | 已启用 |
| Token额度即将耗尽 | 使用率>80% | 已启用 |
| 服务器离线 | 3次心跳检测失败 | 已启用 |
| API响应异常 | 错误率>5% | 已禁用 |

**操作**: 支持添加、编辑、删除规则

#### GPU硬件配置

| 列 | 说明 |
|----|------|
| 服务器名称 | gpu-server-xxx |
| GPU型号 | A100 x8 / H100 x4 等 |
| 所属区域 | 红区/黄区 |
| 状态 | 运行中/高负载/离线 |

**操作**: 点击"+ 添加"新增服务器，支持编辑

#### 模型配置

| 列 | 说明 |
|----|------|
| 模型名称 | LLaMA-7B / GPT-4 等 |
| Token消耗系数 | 1.0x / 2.5x / 3.0x |
| 部署区域 | 红区/黄区/未分配 |
| 状态 | 已启用/已禁用 |

**操作**: 点击"+ 添加"新增模型，支持编辑

#### 系统公告

| 类型 | 颜色标识 | 说明 |
|------|----------|------|
| 重要通知 | 蓝色 | 系统维护等 |
| 额度调整 | 橙色 | 系数变更等 |
| 功能更新 | 灰色 | 新功能上线 |
| 新模型上线 | 灰色 | 模型发布通知 |

**操作**: 点击"+ 发布"发布公告，支持删除

---

## 演示数据说明

### GPU配置
- 总卡数：200张
- 服务器数：20台
- 型号：A100-80G、H100
- 分布：A100 x8 (12台)、H100 x4 (8台)

### 模型列表（20个）
1. LLaMA-7B
2. LLaMA-13B
3. LLaMA-70B
4. GPT-3.5-Turbo
5. GPT-4
6. GPT-4-Turbo
7. StableDiffusion-XL
8. StableDiffusion-v2
9. Whisper-Large
10. Whisper-Medium
11. Mistral-7B
12. Mixtral-8x7B
13. Claude-3-Haiku
14. Claude-3-Opus
15. Gemini-Pro
16. Gemini-Ultra
17. Qwen-7B
18. Qwen-14B
19. Baichuan2-13B
20. InternLM-20B

### 部门列表
1. 芯片设计部
2. 验证部
3. 封装部
4. 测试部
5. 研发部
6. 生产部

---

## 使用方法

### 本地运行
```bash
# 直接用浏览器打开
open index.html
```

### 部署
任何静态文件服务器即可：
- nginx
- Apache
- Vercel
- GitHub Pages
- netlify

---

## 文件结构

```
computing-mangement/
├── index.html          # 登录页
├── dashboard.html      # 主框架（包含所有页面）
├── readme.md           # 本文档
├── css/                # 样式目录（预留）
└── js/
    ├── dashboard.js    # 页面交互和图表逻辑
    ├── auth.js        # 认证和权限模块
    └── data-models.js # 数据模型和查询函数
```

---

## 交互说明

### 导航切换
- 点击左侧导航切换页面
- 当前页面高亮显示
- 普通用户(`?role=user`)自动隐藏管理员菜单

### 运营看板
- 点击"GPU硬件看板"/"Token看板"切换视图
- 时间范围选择器更新图表数据（数据会随机波动模拟实时效果）
- GPU使用率支持按小时/天/周/月粒度切换

### Toast通知
- 操作成功后右上角弹出提示
- 4种类型：成功(绿)/错误(红)/警告(黄)/信息(蓝)
- 3秒后自动消失

### Modal模态框
- 表单操作弹出模态框
- 支持确认/取消操作
- 点击遮罩或关闭按钮可关闭

### 按钮操作
所有按钮均已实现功能：
- **我的算力**: 新建令牌、查看、吊销
- **额度管理**: 添加用户、编辑额度、删除用户、批量导入/导出
- **系统配置**: 保存配置、添加GPU/模型/告警规则、发布公告

### 图表修复
- 修复了服务器负载分布图和模型排行图高度持续增长的bug
- 所有图表都有固定高度容器(280px)
- 柱状图禁用动画，避免视觉异常

---

## 待实现功能（后续开发）

### 1. 后端API对接
- [ ] 用户认证（替换URL参数方式）
- [ ] 算力申请/审批工作流
- [ ] 令牌生成/管理API
- [ ] 数据统计查询接口
- [ ] 表单数据持久化存储

### 2. 数据持久化
- [ ] 数据库设计（用户、额度、令牌、GPU、模型）
- [ ] 使用记录存储与查询
- [ ] 配置数据持久化
- [ ] 历史数据归档

### 3. 实时数据
- [ ] WebSocket连接
- [ ] GPU负载实时推送
- [ ] 告警实时通知（邮件/短信）
- [ ] 在线用户统计

### 4. 高级功能
- [ ] 成本核算（按Token计费）
- [ ] 资源预约系统
- [ ] 负载均衡调度
- [ ] 自动扩缩容
- [ ] 多租户隔离

### 5. 前端优化
- [ ] 响应式布局（移动端适配）
- [ ] 页面路由（支持浏览器前进后退）
- [ ] 数据导出（Excel/PDF）
- [ ] 暗黑/亮色主题切换

---

## 联系方式

半导体数字化与IT装备部

---

## 更新日志

### 2025-02-25
- ✨ 新增项目挂靠功能
  - 用户可在"我的算力"页面查看当前挂靠项目
  - 支持切换项目（只能切换到有余额的项目）
  - 查看项目挂靠历史记录
  - 切换后旧项目标记为"已切换"，余额保留
- ✨ 新增模型筛选功能
  - 运维监控页面支持模型多选筛选
  - 可选择特定模型查看其响应时间和吞吐量趋势
- ✨ 新增项目管理页面
  - 管理员可管理项目配额和成员
  - 项目状态：进行中/已暂停/已完成
- ✨ 新增用户管理页面
  - 用户列表管理
  - 用户额度管理
- ✨ 运营看板扩展为三个视图
  - 运维监控：GPU使用率、模型性能、告警记录
  - 成本运营：Token消耗、部门成本、项目成本
  - 资源分析：用户配额、活跃度、项目归属
- ✨ 优化额度申请流程
  - 项目配额审批通过后自动设置用户项目挂靠关系

### 2025-02-24
- ✨ 新增Toast通知系统
- ✨ 新增Modal模态框组件
- ✨ 实现角色权限控制（URL参数方式）
- ✨ 系统配置页面重构（新增系统参数、告警规则配置）
- ✨ 所有按钮添加完整交互功能
- 🐛 修复图表高度持续增长bug
- 📝 更新项目文档

---

*文档生成时间：2025年*
